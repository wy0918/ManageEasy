<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>ManageEasy - 高校教学项目全生命周期管理平台</title>
  <link rel="icon" href="style/logo/clock.png" type="image/x-icon" />
  <link rel="stylesheet" href="style/css/admin.css">
  <link rel="stylesheet" href="layui/css/layui.css">
  <link rel="stylesheet" href="style/css/ME_common.css">
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header bg-white">
      <div class="layui-logo logo-color">ManageEasy</div>
      <!-- top -->
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item nav-item-black right-25">
          <a href="javascript:;">
            <i class="layui-icon layui-icon-notice i-notice"></i>
            最新邮件<span class="layui-badge"></span>
          </a>
        </li>
        <li class="layui-nav-item nav-item-black">
          <a href="javascript:;">
            <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
            <span name="userName" id="userName"></span>
          </a>
          <dl class=" layui-nav-child">
            <dd><a href="">修改头像</a></dd>
            <dd><a href="javascript:void(0)" id="logout">退出</a></dd>
          </dl>
        </li>
        <!-- <li class="layui-nav-item nav-item-black"><a href="login.html">退出</a></li> -->
      </ul>
      <!-- top -->
    </div>
    <div class="layui-side bg-blue">
      <div class="layui-side-scroll">
        <!-- sidebar -->
        <ul class="layui-nav layui-nav-tree bg-blue" lay-filter="test">
          <!--公共部分-->
          <li class="layui-nav-item nav-item-blue">
            <a href="home.html"><i class="layui-icon layui-icon-home"></i>首页</a>
          </li>
          <!--公共部分-->

          <!--学校管理员-->
          <li class="layui-nav-item layui-nav-itemed nav-item-blue" id="admin_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>申报管理</a>
            <dl class="layui-nav-child">
              <dd><a href="publish.html">发布通知</a></dd>
              <dd><a href="firsthandle.html">初审待处理</a></dd>
              <dd class="layui-this"><a href="distriexpert.html">分配评审专家</a></dd>
              <dd><a href="review.html">专家评审中</a></dd>
              <dd><a href="finishexpert.html">专家评审完成</a></dd>
              <dd><a href="successpro.html">已立项</a></dd>
              <dd><a href="failurepro.html">评审后未立项</a></dd>
              <!--教职工-->
              <!-- <dd><a href="replist.html">申报通知</a></dd>
                         <dd><a href="myrep.html">我的申报</a></dd>-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right2">
            <a href="javascript:;"><i class="layui-icon layui-icon-search"></i>中期检查管理</a>
            <dl class="layui-nav-child">
              <dd><a href="midrep.html">发布通知</a></dd>
              <dd><a href="midhandle.html">审核项目</a></dd>
              <dd><a href="midsuccess.html">已通过项目</a></dd>
              <dd><a href="midfailure.html">待整改项目</a></dd>
              <!--教职工-->
              <!--<dd><a href="midteahandle.html">待处理通知</a></dd>
                        <dd><a href="midsuccess.html">已通过项目</a></dd>
                        <dd><a href="midmodify.html">待整改项目</a></dd>-->
              <!--已通过项目页面同学校管理员-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right3">
            <a href="javascript:;"><i class="layui-icon layui-icon-read"></i>结题验收管理</a>
            <dl class="layui-nav-child">
              <dd><a href="finalrep.html">发布通知</a></dd>
              <dd><a href="finalhandle.html">审核项目</a></dd>
              <dd><a href="finalsuccess.html">已通过项目</a></dd>
              <dd><a href="finalfailure.html">待整改项目</a></dd>
              <!--教职工-->
              <!--<dd><a href="finalteahandle.html">待处理通知</a></dd>
                        <dd><a href="finalsuccess.html">已通过项目</a></dd>
                        <dd><a href="finalmodify.html">待整改项目</a></dd>-->
              <!--已通过项目页面同学校管理员-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right4">
            <a href="javascript:;"><i class="layui-icon layui-icon-user"></i>用户管理</a>
            <dl class="layui-nav-child">
              <dd><a href="user.html">用户信息管理</a></dd>
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right5">
            <a href="news.html"><i class="layui-icon layui-icon-notice"></i>通知管理</a>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right6">
            <a href="javascript:;"><i class="layui-icon layui-icon-set"></i>系统设置</a>
            <dl class="layui-nav-child">
              <dd><a href="character.html">角色管理</a></dd>
            </dl>
          </li>
          <!--学校管理员-->

          <!--教职工-->
          <li class="layui-nav-item nav-item-blue" id="teacher_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>申报管理</a>
            <dl class="layui-nav-child">
              <dd><a href="replist.html">申报通知</a></dd>
              <dd><a href="myrep.html">我的申报</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="teacher_right2">
            <a href="javascript:;"><i class="layui-icon layui-icon-search"></i>中期检查管理</a>
            <dl class="layui-nav-child">
              <dd><a href="midteahandle.html">待处理通知</a></dd>
              <dd><a href="midsuccess.html">已通过项目</a></dd>
              <dd><a href="midmodify.html">待整改项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="teacher_right3">
            <a href="javascript:;"><i class="layui-icon layui-icon-read"></i>结题验收管理</a>
            <dl class="layui-nav-child">
              <dd><a href="finalteahandle.html">待处理通知</a></dd>
              <dd><a href="finalsuccess.html">已通过项目</a></dd>
              <dd><a href="finalmodify.html">待整改项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="teacher_right4">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>资料管理</a>
            <dl class="layui-nav-child">
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>
          <!--教职工-->

          <!--外部评审专家-->
          <li class="layui-nav-item nav-item-blue" id="expert_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>项目评审</a>
            <dl class="layui-nav-child">
              <dd><a href="expert.html">未评审项目</a></dd>
              <dd><a href="expertlist.html">已评审项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="expert_right2">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>资料管理</a>
            <dl class="layui-nav-child">
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>
          <!--资料管理-密码部分=用户管理-密码重置；-->
          <!--已评审页面同专家评审完成页面同所以建议将项目评审模块和申报管理模块内容合并,这里依然做分开处理-->
          <!--外部评审专家-->
        </ul>
        <!-- sidebar -->
      </div>
    </div>

    <div class="layui-body layui-bg-gray">
      <!-- content -->
      <div style="padding: 15px;">
        <!--blank-->
        <br>
        <h1>分配评审专家</h1>
        <!--homepage news-->
        <br>
        <div class="layui-fluid">
          <div class="layui-card pad-40">
            <!--form筛选-->
            <form class="layui-form" action="#">
              <div class="layui-form-item">
                <label class="layui-form-label">项目类型：</label>
                <div class="layui-input-inline">
                  <select id="ptId" lay-verify="required" lay-filter="select_protype">
                    <option value="1">教改项目</option>
                    <option value="2">课程建设项目</option>
                    <option value="3">专业建设项目</option>
                  </select>
                </div>
                <label class="layui-form-label">项目状态：</label>
                <div class="layui-input-inline">
                  <select id="ptState" lay-verify="required" lay-filter="select_prostate">
                    <!-- <option value="0">初审中</option> -->
                    <option value="1">初审通过</option>
                    <!-- <option value="2">不立项</option> -->
                    <!-- <option value="3">专家评审中</option>
                    <option value="4">专家评审完成</option>
                    <option value="5">立项</option>
                    <option value="6">中期检查审核中</option>
                    <option value="7">中期检查通过</option>
                    <option value="8">中期检查待整改</option>
                    <option value="9">结题验收审核中</option>
                    <option value="10">结题验收通过</option>
                    <option value="11">结题验收待整改</option> -->
                  </select>
                </div>
              </div>
            </form>
            <!--form筛选-->
            <!--table-->
            <table class="layui-hide" id="table1" lay-filter="table1"></table>
            <!-- <button class="layui-btn bg-blue right" id="distributeConfirm">确认分配</button> -->
            <!--table操作-->
            <!-- <script type="text/html" id="toolbar1"></script> -->
            <script type="text/html" id="bar1">
              <a class="layui-btn layui-btn-xs" lay-event="disConfirm">确认分配</a>
            </script>

            <!-- <script type="text/html" id="deadline">
                <input type="text" class="layui-input" id="date" lay-filter="deadline">
             </script> -->
            <!--table-->
          </div>
        </div>
        <!-- <div class="layui-tab layui-tab-brief layadmin-latestdata" lay-filter="demo">
          <ul class="layui-tab-title">
            <li class="layui-this">教改项目</li>
            <li>课程建设项目</li>
            <li>专业建设项目</li>
          </ul>
          <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
              <div class="layui-card">
        <table class="layui-hide" id="table1" lay-filter="table1">
        </table>
      </div>
      <button class="layui-btn bg-blue right" id="distributeConfirm">确认分配</button>
      
      <script type="text/html" id="toolbar1">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm bg-blue" lay-event="getCheckData">获取选中行数据</button>
    <button class="layui-btn layui-btn-sm bg-blue" lay-event="getCheckLength">获取选中数目</button>
    <button class="layui-btn layui-btn-sm bg-blue" lay-event="isAll">验证是否全选</button>
  </div>
</script>
      <script type="text/html" id="deadline">
   <input type="text" class="layui-input" id="date">
</script>
      
    </div>
    <div class="layui-tab-item">
      课程建设项目
    </div>
    <div class="layui-tab-item">
      专业建设项目
    </div>
  </div>
  </div> -->

        <!--homepage news-->

      </div>
      <!--blank-->
    </div>
    <!-- content -->
  </div>

  <div class="layui-footer">
    <!-- footer -->
    © ManageEasy - 高校教学项目全生命周期管理平台
  </div>
  </div>
  <div id="addjEndtime" style="padding: 25px;display: none">
    <form class="layui-form" action="" lay-filter="formDistri" id="formDistri">
      <div class="layui-form-item">
        <label class="layui-form-label">截止日期</label>
        <div class="layui-input-block">
          <input type="text" class="layui-input" id="date" name="jEndtime">
        </div>
      </div>
      <div class="layui-form-item">
        <div class="layui-input-block right">
          <button class="layui-btn bg-blue" lay-submit lay-filter="btndistrisubmit" id="btndistri">确认分配</button>
          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
      </div>
    </form>
  </div>
  <script src="layui/layui.js"></script>
  <script src="style/js/index.js"></script>
  <script>
    layui.use(['element', 'table', 'form', 'laydate', 'layer'], function () {
      var element = layui.element;
      var table = layui.table;
      var form = layui.form;
      var laydate = layui.laydate;
      var $ = layui.jquery, layer = layui.layer;

      //教改项目table  
      var showDisTable = function (url) {
        table.render({
          elem: '#table1'
          , url: url
          // , toolbar: '#toolbar1'
          , title: '分配评审专家'
          , request: {
            pageName: 'pageNum', //页码的参数名称，默认：page
            limitName: 'pageSize' //每页数据量的参数名，默认：limit
          }
          , response: {
            statusName: 'code' //规定数据状态的字段名称，默认：code
            //,statusCode: 200 //规定成功的状态码，默认：0
            , msgName: 'msg' //规定状态信息的字段名称，默认：msg
            , countName: 'totalCount' //规定数据总数的字段名称，默认：count
            , dataName: 'data' //规定数据列表的字段名称，默认：data
          }
          , parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
            var datas = [];
            for (let i = 0; i < (res.data).length; i++) {
              var level = res.data[i].level;
              var department = res.data[i].department;
              var projecttype = res.data[i].projecttype;
              datas[i] = Object.assign(res.data[i].project, res.data[i].user);
              datas[i] = Object.assign({}, datas[i], { level }, { department }, { projecttype });
            }
            return {
              "code": 0, //解析接口状态
              "msg": '', //解析提示文本
              "totalCount": res.totalCount, //解析数据长度
              "data": datas //解析数据列表
            };
          }
          , cols: [[
            { field: 'pName', title: '项目名称', align: 'center' }
            , { field: 'level', title: '项目级别', align: 'center' }
            , { field: 'uName', title: '负责人姓名', align: 'center' }
            , { field: 'department', title: '所属学院', align: 'center' }
            //, { field: 'jEndtime', title: '截止时间',edit:'text', align: 'center' }//templet: '#deadline' 
            , { field: 'right', title: '操作', align: 'center', toolbar: '#bar1' }
          ]]
          , page: true
        });
      }
      var url1 = 'http://localhost:8006/project/queryByUSPt?state=1&type=' + $("#ptId").find("option:selected").val();
      showDisTable(url1);

      //监听select事件(项目类型)
      form.on('select(select_protype)', function (data) {
        var url = 'http://localhost:8006/project/queryByUSPt?state=1&type=' + data.value;
        showDisTable(url);
      });

      //执行laydate
      laydate.render({
        elem: '#date' //指定元素
      });

      //监听行工具事件
      table.on('tool(table1)', function (obj) {
        var data = obj.data;

        //console.log(obj)
        if (obj.event === 'disConfirm') {
          layer.open({
            type: 1
            , title: '添加截止日期'
            , area: ['auto', 'auto']
            , closeBtn: 1
            , shade: 0.8
            //, id: 'LAY_layuipro' //设定一个id，防止重复弹出
            , btnAlign: 'c'
            , moveType: 1 //拖拽模式，0或者1
            , content: $('#addjEndtime')
          });
          var datas = data;
          //提交修改用户的数据
          form.on('submit(btndistrisubmit)', function (data) {
            var formdata = data.field;
            var deadline = formdata.jEndtime;
            var settings = {
              "url": "http://localhost:8006/judge/add?id=" + datas.pId,
              "method": "POST",
              "timeout": 0,
              "headers": {
                "Content-Type": "application/json"
              },
              "data": "\"" + deadline + "\""
            };
            $.ajax(settings).done(function (response) {
              if (response.jId != "" && response.jId != null) {
                layer.msg('分配成功，分配到的评审专家id为'+response.uId, {
                  offset: '15px'
                  , icon: 1
                  , time: 2000
                }, function () {
                  window.parent.location.reload();
                });
              }
            }).fail(function (data, status, xhr) {
              layer.msg('error', {
                offset: '15px'
                , icon: 1
                , time: 1000
              }, function () {
                console.log(data);
              });
            });
            return false;
          });
          // layer.confirm('确认分配吗?', {
          //   btn: ['确认', '取消'] //按钮
          // }, function () {
          //});
        }
      });

      //分配专家
      // $(document).on('click', '#distributeConfirm', function () {

      // });

    }); 
  </script>
</body>

</html>