<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>ManageEasy - 高校教学项目全生命周期管理平台</title>
  <link rel="icon" href="style/logo/clock.png" type="image/x-icon" />
  <link rel="stylesheet" href="style/css/admin.css">
  <link rel="stylesheet" href="layui/css/layui.css">
  <link rel="stylesheet" href="style/css/ME_common.css">
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header bg-white">
      <div class="layui-logo logo-color">ManageEasy</div>
      <!-- top -->
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item nav-item-black right-25">
          <a href="javascript:;">
            <i class="layui-icon layui-icon-notice i-notice"></i>
            最新邮件<span class="layui-badge">99+</span>
          </a>
        </li>
        <li class="layui-nav-item nav-item-black">
          <a href="javascript:;">
            <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
            <span name="userName" id="userName"></span>
          </a>
          <dl class=" layui-nav-child">
            <dd><a href="">修改头像</a></dd>
            <dd><a href="javascript:void(0)" id="logout">退出</a></dd>
          </dl>
        </li>
        <!-- <li class="layui-nav-item nav-item-black"><a href="login.html">退出</a></li> -->
      </ul>
      <!-- top -->
    </div>
    <div class="layui-side bg-blue">
      <div class="layui-side-scroll">
        <!-- sidebar -->
        <ul class="layui-nav layui-nav-tree bg-blue" lay-filter="test">
          <!--公共部分-->
          <li class="layui-nav-item nav-item-blue">
            <a href="home.html"><i class="layui-icon layui-icon-home"></i>首页</a>
          </li>
          <!--公共部分-->

          <!--学校管理员-->
          <li class="layui-nav-item nav-item-blue" id="admin_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>申报管理</a>
            <dl class="layui-nav-child">
              <dd><a href="publish.html">发布通知</a></dd>
              <dd><a href="firsthandle.html">初审待处理</a></dd>
              <dd><a href="distriexpert.html">分配评审专家</a></dd>
              <dd><a href="review.html">专家评审中</a></dd>
              <dd><a href="finishexpert.html">专家评审完成</a></dd>
              <dd><a href="successpro.html">已立项</a></dd>
              <dd><a href="failurepro.html">评审后未立项</a></dd>
              <!--教职工-->
              <!-- <dd><a href="replist.html">申报通知</a></dd>
                             <dd><a href="myrep.html">我的申报</a></dd>-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right2">
            <a href="javascript:;"><i class="layui-icon layui-icon-search"></i>中期检查管理</a>
            <dl class="layui-nav-child">
              <dd><a href="midrep.html">发布通知</a></dd>
              <dd><a href="midhandle.html">审核项目</a></dd>
              <dd><a href="midsuccess.html">已通过项目</a></dd>
              <dd><a href="midfailure.html">待整改项目</a></dd>
              <!--教职工-->
              <!--<dd><a href="midteahandle.html">待处理通知</a></dd>
                            <dd><a href="midsuccess.html">已通过项目</a></dd>
                            <dd><a href="midmodify.html">待整改项目</a></dd>-->
              <!--已通过项目页面同学校管理员-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right3">
            <a href="javascript:;"><i class="layui-icon layui-icon-read"></i>结题验收管理</a>
            <dl class="layui-nav-child">
              <dd><a href="finalrep.html">发布通知</a></dd>
              <dd><a href="finalhandle.html">审核项目</a></dd>
              <dd><a href="finalsuccess.html">已通过项目</a></dd>
              <dd><a href="finalfailure.html">待整改项目</a></dd>
              <!--教职工-->
              <!--<dd><a href="finalteahandle.html">待处理通知</a></dd>
                            <dd><a href="finalsuccess.html">已通过项目</a></dd>
                            <dd><a href="finalmodify.html">待整改项目</a></dd>-->
              <!--已通过项目页面同学校管理员-->
              <!--教职工-->
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right4">
            <a href="javascript:;"><i class="layui-icon layui-icon-user"></i>用户管理</a>
            <dl class="layui-nav-child">
              <dd><a href="user.html">用户信息管理</a></dd>
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right5">
            <a href="news.html"><i class="layui-icon layui-icon-notice"></i>通知管理</a>
          </li>

          <li class="layui-nav-item nav-item-blue" id="admin_right6">
            <a href="javascript:;"><i class="layui-icon layui-icon-set"></i>系统设置</a>
            <dl class="layui-nav-child">
              <dd><a href="character.html">角色管理</a></dd>
            </dl>
          </li>
          <!--学校管理员-->

          <!--教职工-->
          <li class="layui-nav-item nav-item-blue" id="teacher_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>申报管理</a>
            <dl class="layui-nav-child">
              <dd><a href="replist.html">申报通知</a></dd>
              <dd><a href="myrep.html">我的申报</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item layui-nav-itemed nav-item-blue" id="teacher_right2">
            <a href="javascript:;"><i class="layui-icon layui-icon-search"></i>中期检查管理</a>
            <dl class="layui-nav-child">
              <dd class="layui-this"><a href="midteahandle.html">待处理通知</a></dd>
              <dd><a href="midsuccess.html">已通过项目</a></dd>
              <dd><a href="midmodify.html">待整改项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="teacher_right3">
            <a href="javascript:;"><i class="layui-icon layui-icon-read"></i>结题验收管理</a>
            <dl class="layui-nav-child">
              <dd><a href="finalteahandle.html">待处理通知</a></dd>
              <dd><a href="finalsuccess.html">已通过项目</a></dd>
              <dd><a href="finalmodify.html">待整改项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="teacher_right4">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>资料管理</a>
            <dl class="layui-nav-child">
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>
          <!--教职工-->

          <!--外部评审专家-->
          <li class="layui-nav-item nav-item-blue" id="expert_right1">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>项目评审</a>
            <dl class="layui-nav-child">
              <dd><a href="expert.html">未评审项目</a></dd>
              <dd><a href="expertlist.html">已评审项目</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item nav-item-blue" id="expert_right2">
            <a class="" href="javascript:;"><i class="layui-icon layui-icon-form"></i>资料管理</a>
            <dl class="layui-nav-child">
              <dd><a href="pw.html">密码重置</a></dd>
            </dl>
          </li>
          <!--资料管理-密码部分=用户管理-密码重置；-->
          <!--已评审页面同专家评审完成页面同所以建议将项目评审模块和申报管理模块内容合并,这里依然做分开处理-->
          <!--外部评审专家-->
        </ul>
        <!-- sidebar -->
      </div>
    </div>

    <div class="layui-body layui-bg-gray">
      <!-- content -->
      <div style="padding: 15px;">
        <!--blank-->
        <br>
        <h1>待处理通知</h1>
        <br>
        <a href="midteahandle.html"><strong class="right word-blue right-35"><i class="layui-icon layui-icon-return"></i>返回列表</strong></a>
        <div class="layui-card" style="margin: 30px">
          <div class="layui-card-header">
            <h2 class="center" style="color: red">关于<span id="n_title"></span>的中期检查通知</h2>
            <p class="center">
              上传时间：<span id="n_regTime"><strong></strong></span>
              &nbsp;&nbsp;&nbsp;&nbsp;
              项目类型：<span id="pro_type"><strong></strong></span>
              &nbsp;&nbsp;&nbsp;&nbsp;
              申报截止时间：<span id="n_deadline"><strong></strong></span>
            </p>
          </div>
          <br><br><br>
          <div class="layui-card-body layuiadmin-card-list">
            <p class="center" id="n_content"></p><br><br>
            <h3 class="layuiadmin-big-font word-blue left-25 bottom-50">附件下载：
              <a href="javascript:void(0)" id="downloadNtf">点击下载</a>
            </h3>
          </div>
        </div>
        <button class="layui-btn bg-blue right right-25" style="width: 180px" id="midcheck">
          <i class="layui-icon">&#xe642;</i> 中期检查
        </button>
      </div>
      <!--blank-->
    </div>
    <!-- content -->
  </div>

  <div class="layui-footer">
    <!-- footer -->
    © ManageEasy - 高校教学项目全生命周期管理平台
  </div>
  </div>
  <div id="checkdetails" style="padding: 15px;display: none">
    <form class="layui-form" action="" lay-filter="formPro">
      <div class="layui-form-item">
        <label class="layui-form-label">项目等级</label>
        <div class="layui-input-block">
          <select name="plId" lay-verify="required" id="plId">
            <option value="1">校级一类</option>
            <option value="2">校级二类</option>
            <option value="3">校级三类</option>
          </select>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">项目名称</label>
        <div class="layui-input-block">
          <input type="text" name="pName" id="pName" required lay-verify="required" placeholder="请输入项目名称" autocomplete="off"
            class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">上传材料</label>
        <div class="layui-input-block">
          <button type="button" class="layui-btn layui-btn-primary" id="addMe"><i class="layui-icon"></i>上传压缩文件</button>
        </div>
      </div><br>

      <div class="layui-form-item">
        <div class="layui-input-block right">
          <button type="button" class="layui-btn bg-blue" lay-submit lay-filter="middetailsForm" id="middetailsForm">立即提交</button>
          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
      </div>
    </form>
  </div>
  <script src="layui/layui.js"></script>
  <script src="style/js/index.js"></script>
  <script>
    layui.use(['element', 'table', 'form', 'layer', 'laydate', 'upload'], function () {
      var element = layui.element;
      var table = layui.table;
      var form = layui.form;
      var $ = layui.jquery, layer = layui.layer;
      var laydate = layui.laydate;
      var upload = layui.upload;

      var userinfo = JSON.parse(localStorage.getItem("userinfo"));
      var ntfinfo = JSON.parse(localStorage.getItem("ntfinfo"));

      $("#n_title").html(ntfinfo.nTitle);
      $("#n_regTime").html(formatTime(ntfinfo.nRegtime));
      $("#pro_type").html(getProtypename(ntfinfo.ptId));
      $("#n_deadline").html(formatTime(ntfinfo.nDeadline));
      $("#n_content").html(ntfinfo.nContent);

      //执行laydate
      // laydate.render({
      //   elem: '#startdate' //指定元素
      // });

      // laydate.render({
      //   elem: '#enddate' //指定元素
      // });

      //下载通知书
      $("#downloadNtf").click(function () {
        var url = "http://localhost:8006/file/download?path=" + ntfinfo.nFiles;
        var settings = {
          "url": url,
          "method": "GET",
          "timeout": 0,
        };
        $.ajax(settings).done(function (response) {
          window.location.href = url;
        }).fail(function (data, status, xhr) {
          layer.msg(status + ":未上传文件", {
            offset: '15px'
            , icon: 1
            , time: 1000
          });
        });
      })

      //上传中期检查材料
      var form1 = new FormData();
      form1.append("file", "");
      upload.render({ //允许上传的文件后缀
        elem: '#addMe'
        , url: 'http://localhost:8006/project/addMe'
        , accept: 'file' //普通文件
        , method: 'post'
        , data: form1
        , exts: 'zip|rar|7z' //只允许上传压缩文件
        , done: function (res, index, upload) {
          layer.msg('上传成功!', {
            offset: '15px'
            , icon: 1
            , time: 1000
          })
        }
      });

      //检查信息
      $(document).on('click', '#midcheck', function () {
        layer.open({
          type: 1
          , title: '中期检查基本信息'
          , area: ['auto', 'auto']
          , closeBtn: 1
          , shade: 0.8
          , id: 'LAY_layuipro' //设定一个id，防止重复弹出
          , btnAlign: 'c'
          , moveType: 1 //拖拽模式，0或者1
          , content: $('#checkdetails')
        });

      });

      //提交项目基本信息
      form.on('submit(middetailsForm)', function (data) {
        var datas = data.field;
        var plId = $("#plId").find("option:selected").val();
        var pName = $("#pName").val();
        var settings = {
          "url": "http://localhost:8006/project/saveMF?level=" + plId + "&name=" + pName,
          "method": "GET",
          "timeout": 0,
          "xhrFields": { withCredentials: true }
        };
        $.ajax(settings).done(function (response) {
          if (response.pId !== '' && response.pId != null) {
            layer.msg('提交成功', {
              offset: '15px'
              , icon: 1
              , time: 1000
            }, function () {
              window.parent.location.reload();
              var index = parent.layer.getFrameIndex(window.name);
              parent.layer.close(index);
            });
          }
        }).fail(function (data, status, xhr) {
          layer.msg(status + '\n未查询到相关项目，请重新输入', {
            offset: '15px'
            , icon: 1
            , time: 2000
          }, function () {
            // window.parent.location.reload();
            // var index = parent.layer.getFrameIndex(window.name);
            // parent.layer.close(index);
          });
        });
        return false;
      });

    }); 
  </script>
</body>

</html>